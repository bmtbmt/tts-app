<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>á»¨ng dá»¥ng há»c phÃ¡t Ã¢m vá»›i SpeechSynthesis API</title>
  <style>
    body { font-family: sans-serif; padding: 20px; max-width: 600px; margin: auto; }
    textarea { width: 100%; height: 80px; margin-bottom: 10px; }
    select, input[type=range] { width: 100%; margin: 6px 0; }
    button { padding: 8px 16px; margin: 4px; }
    label { font-weight: bold; display: block; margin-top: 10px; }
  </style>
</head>
<body>
  <h2>ğŸ—£ï¸ á»¨ng dá»¥ng há»c phÃ¡t Ã¢m báº±ng TTS (Native)</h2>

  <label for="exampleSelect">ğŸ“š Chá»n máº«u cÃ¢u:</label>
  <select id="exampleSelect" onchange="setExampleText()">
    <option value="">-- Chá»n máº«u --</option>
    <option>Hello! How are you?</option>
    <option>This is a text-to-speech demo.</option>
    <option>Xin chÃ o! TÃ´i Ä‘ang há»c phÃ¡t Ã¢m.</option>
    <option>I love learning English pronunciation.</option>
  </select>

  <label for="text">âœï¸ Nháº­p vÄƒn báº£n:</label>
  <textarea id="text">Hello! How are you?</textarea>

  <label for="voiceSelect">ğŸ—£ï¸ Chá»n giá»ng:</label>
  <select id="voiceSelect"></select>

  <label for="rate">â© Tá»‘c Ä‘á»™ nÃ³i: <span id="rateVal">1.0</span></label>
  <input type="range" id="rate" min="0.5" max="2.0" value="1.0" step="0.1" oninput="updateSlider('rate')" />

  <label for="pitch">ğŸµ Cao Ä‘á»™: <span id="pitchVal">1.0</span></label>
  <input type="range" id="pitch" min="0.5" max="2.0" value="1.0" step="0.1" oninput="updateSlider('pitch')" />

  <div style="margin-top:10px;">
    <button onclick="speak()">â–¶ï¸ Nghe phÃ¡t Ã¢m</button>
    <button onclick="cancel()">â¹ï¸ Dá»«ng láº¡i</button>
  </div>

  <p id="status"></p>

  <script>
    const synth = window.speechSynthesis;
    const voiceSelect = document.getElementById("voiceSelect");
    const rateInput = document.getElementById("rate");
    const pitchInput = document.getElementById("pitch");

    function populateVoices() {
      const voices = synth.getVoices();
      voiceSelect.innerHTML = "";
      voices.forEach((voice, i) => {
        const option = document.createElement("option");
        option.value = i;
        option.textContent = `${voice.name} (${voice.lang})`;
        voiceSelect.appendChild(option);
      });
    }

    populateVoices();
    if (typeof speechSynthesis !== "undefined" && speechSynthesis.onvoiceschanged !== undefined) {
      speechSynthesis.onvoiceschanged = populateVoices;
    }

    function updateSlider(id) {
      const val = document.getElementById(id).value;
      document.getElementById(id + "Val").textContent = val;
    }

    function setExampleText() {
      const example = document.getElementById("exampleSelect").value;
      if (example) document.getElementById("text").value = example;
    }

    function speak() {
      synth.cancel();  // Há»§y trÆ°á»›c Ä‘Ã³, quan trá»ng trÃªn di Ä‘á»™ng
      const text = document.getElementById("text").value;
      if (!text.trim()) return;

      const utter = new SpeechSynthesisUtterance(text);
      const voices = synth.getVoices();
      utter.voice = voices[voiceSelect.value] || null;
      utter.rate = parseFloat(rateInput.value);
      utter.pitch = parseFloat(pitchInput.value);

      utter.onstart = () => document.getElementById("status").textContent = "ğŸ”Š Äang Ä‘á»c...";
      utter.onend = () => document.getElementById("status").textContent = "âœ… HoÃ n táº¥t.";
      utter.onerror = () => document.getElementById("status").textContent = "âŒ Lá»—i phÃ¡t Ã¢m.";

      synth.speak(utter);
    }

    function cancel() {
      synth.cancel();
      document.getElementById("status").textContent = "â¹ï¸ ÄÃ£ dá»«ng.";
    }
  </script>
</body>
</html>
